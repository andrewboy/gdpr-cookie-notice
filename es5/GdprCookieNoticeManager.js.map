{"version":3,"sources":["../src/GdprCookieNoticeManager.js"],"names":["locales","options","console","log","_opts","categories","acceptOnScroll","namespace","expiration","domain","window","location","hostname","pluginPrefix","locale","timeout","statementUrl","isCategoriesAcceptedByDefault","_isCookiesAccepted","load","GdprCookieNoticePopup","GdprCookieModal","isCategoriesCheckedByDefault","destroy","Object","assign","_gdprCookie","GdprCookie","_notice","_getNotice","_modal","_getModal","isExists","show","_acceptOnScroll","_deleteUnacceptableCookies","_fireCookieEnvabledEvent","_setModalShowButton","addEventListener","_listener","_amountScrolled","acceptAllCategories","removeEventListener","bind","windowHeight","innerHeight","document","documentElement","body","clientHeight","documentHeight","Math","max","scrollHeight","offsetHeight","scrollTop","pageYOffset","parentNode","trackLength","pctScrolled","floor","globalSettingsButtons","querySelectorAll","i","length","e","preventDefault","dispatchEvent","CustomEvent","detail","get","evt","data","acceptCategories","performance","analytics","marketing","Error","isPerformanceAccepted","isAnalyticsAccepted","isMarketingAccepted","set","isNecessaryAccepted","hide","Cookies","remove"],"mappings":"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","file":"GdprCookieNoticeManager.js","sourcesContent":["import GdprCookieModal from './GdprCookieModal'\r\nimport * as locales from './locales'\r\nimport GdprCookieNoticePopup from './GdprCookieNoticePopup'\r\nimport GdprCookie from './GdprCookie'\r\nimport Cookies from 'js-cookie'\r\n\r\nexport default class {\r\n  constructor (options) {\r\n    console.log('GdprCookieNotice:constructor')\r\n    this._opts = {\r\n      categories: {},\r\n      acceptOnScroll: false,\r\n      //cookie\r\n      namespace: 'gdprcookienotice',\r\n      expiration: 30,\r\n      domain: window.location.hostname,\r\n      //boxes\r\n      pluginPrefix: 'gdpr-cookie-notice',\r\n      locale: 'en_GB',\r\n      //notice\r\n      timeout: 500,\r\n      statementUrl: '',\r\n      //modal\r\n      isCategoriesAcceptedByDefault: false\r\n    }\r\n    this._isCookiesAccepted = false\r\n    this.load(options)\r\n  }\r\n\r\n  _getNotice () {\r\n    return new GdprCookieNoticePopup(\r\n      this,\r\n      this._opts.pluginPrefix,\r\n      locales[this._opts.locale]['notice'],\r\n      this._opts.timeout\r\n    )\r\n  }\r\n\r\n  _getModal () {\r\n    return new GdprCookieModal(\r\n      this,\r\n      this._opts.pluginPrefix,\r\n      locales[this._opts.locale]['modal'],\r\n      this._opts.statementUrl,\r\n      this._opts.isCategoriesCheckedByDefault\r\n    )\r\n  }\r\n\r\n  load (options) {\r\n    //remove actual\r\n    this.destroy()\r\n\r\n    //reset options\r\n    this._opts = Object.assign({}, this._opts, options)\r\n\r\n    //cookie\r\n    this._gdprCookie = new GdprCookie(this._opts.namespace, this._opts.expiration, this._opts.domain)\r\n    //notice\r\n    this._notice = this._getNotice()\r\n    //modal\r\n    this._modal = this._getModal()\r\n\r\n    if (!this._gdprCookie.isExists()) {\r\n      console.log('cookie not set')\r\n      this._notice.show()\r\n\r\n      if (this._opts.acceptOnScroll) {\r\n        this._acceptOnScroll()\r\n      }\r\n    } else {\r\n      console.log('cookie SET')\r\n      this._deleteUnacceptableCookies()\r\n      this._fireCookieEnvabledEvent()\r\n    }\r\n\r\n    this._setModalShowButton()\r\n  }\r\n\r\n  destroy () {\r\n    if (this._notice) {\r\n      this._notice.destroy()\r\n    }\r\n\r\n    if (this._modal) {\r\n      this._modal.destroy()\r\n    }\r\n  }\r\n\r\n  //acceptonscroll =========\r\n\r\n  _acceptOnScroll () {\r\n    window.addEventListener('scroll', function _listener () {\r\n      console.log(this)\r\n      if (this._amountScrolled()) {\r\n        console.log('accepted on scroll')\r\n        this.acceptAllCategories()\r\n        window.removeEventListener('scroll', _listener)\r\n      }\r\n    }.bind(this))\r\n  }\r\n\r\n  _amountScrolled () {\r\n    console.log('_amountScrolled')\r\n    let windowHeight = window.innerHeight || (document.documentElement || document.body).clientHeight\r\n    let documentHeight = Math.max(\r\n      document.body.scrollHeight, document.documentElement.scrollHeight,\r\n      document.body.offsetHeight, document.documentElement.offsetHeight,\r\n      document.body.clientHeight, document.documentElement.clientHeight\r\n    )\r\n    let scrollTop = window.pageYOffset || (document.documentElement || document.body.parentNode || document.body).scrollTop\r\n    let trackLength = documentHeight - windowHeight\r\n    let pctScrolled = Math.floor(scrollTop / trackLength * 100) // gets percentage scrolled (ie: 80 or NaN if tracklength == 0)\r\n    if (pctScrolled > 25 && !this._isCookiesAccepted) {\r\n      this._isCookiesAccepted = true\r\n      return true\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n\r\n  //==============\r\n\r\n  _setModalShowButton () {\r\n    let globalSettingsButtons = document.querySelectorAll('.' + this._opts.pluginPrefix + '-settings-button')\r\n\r\n    console.log(globalSettingsButtons)\r\n\r\n    if (globalSettingsButtons) {\r\n      for (let i = 0; i < globalSettingsButtons.length; i++) {\r\n        console.log('globalSettingsButtons LOOP', i, globalSettingsButtons[i])\r\n        globalSettingsButtons[i].addEventListener('click', (e) => {\r\n          e.preventDefault()\r\n          this._modal.show()\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  _fireCookieEnvabledEvent () {\r\n    document.dispatchEvent(new CustomEvent('gdprCookiesEnabled', {detail: this._gdprCookie.get()}))\r\n  }\r\n\r\n  setEvent (evt, data) {\r\n    switch (evt) {\r\n      case 'accept_all_category':\r\n        this.acceptAllCategories()\r\n        break\r\n\r\n      case 'accept_categories':\r\n        this.acceptCategories(data.performance, data.analytics, data.marketing)\r\n        break\r\n\r\n      case 'show_modal':\r\n        this._modal.show()\r\n        break\r\n\r\n      default:\r\n        throw new Error('Event type not supported')\r\n    }\r\n  }\r\n\r\n  acceptAllCategories () {\r\n    this.acceptCategories(\r\n      !!this._opts.categories.performance,\r\n      !!this._opts.categories.analytics,\r\n      !!this._opts.categories.marketing,\r\n    )\r\n  }\r\n\r\n  //COOKIE =============================================================================================================\r\n\r\n  acceptCategories (isPerformanceAccepted, isAnalyticsAccepted, isMarketingAccepted) {\r\n    console.log('acceptCategories', isPerformanceAccepted, isAnalyticsAccepted, isMarketingAccepted)\r\n    // Load marketing scripts that only works when cookies are accepted\r\n    this._gdprCookie.set(\r\n      true,\r\n      isPerformanceAccepted,\r\n      isAnalyticsAccepted,\r\n      isMarketingAccepted\r\n    )\r\n\r\n    this._deleteUnacceptableCookies()\r\n\r\n    this._fireCookieEnvabledEvent()\r\n\r\n    if (this._gdprCookie.isExists() && this._gdprCookie.isNecessaryAccepted()) {\r\n      this._notice.hide()\r\n    } else {\r\n      this._notice.show()\r\n    }\r\n  }\r\n\r\n  _deleteUnacceptableCookies () {\r\n    if (!this._gdprCookie.isExists()) {\r\n      return\r\n    }\r\n\r\n    //analytics\r\n    if (!!this._opts.categories.analytics && !this._gdprCookie.isAnalyticsAccepted()) {\r\n      for (let i in this._opts.categories.analytics) {\r\n        Cookies.remove(this._opts.categories.analytics[i])\r\n      }\r\n    }\r\n\r\n    //performance\r\n    if (!!this._opts.categories.performance && !this._gdprCookie.isPerformanceAccepted()) {\r\n      for (let i in this._opts.categories.performance) {\r\n        Cookies.remove(this._opts.categories.performance[i])\r\n      }\r\n    }\r\n\r\n    //marketing\r\n    if (!!this._opts.categories.marketing && !this._gdprCookie.isMarketingAccepted()) {\r\n      for (let i in this._opts.categories.marketing) {\r\n        Cookies.remove(this._opts.categories.marketing[i])\r\n      }\r\n    }\r\n  }\r\n\r\n  //=================================\r\n\r\n  get categories () {\r\n    return this._opts.categories\r\n  }\r\n}"]}